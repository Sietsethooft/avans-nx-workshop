<div *ngIf="isLoading" class="container p-3">
  <div class="row">
    <div class="col-xl-4">
      <div class="card mb-4 mb-xl-0">
        <div class="card-header" style="background-color: #435d7d; color: white;"><h4>Profielfoto</h4></div>
        <div class="card-body text-center">
          <img
            class="img-account-profile rounded-circle mb-2"
            src="https://lpcna.nhs.uk/application/files/1516/0322/1131/person-placeholder.jpg"
            alt="Profielfoto"
            style="width: 200px; height: 200px;"
          >
        </div>
      </div>
    </div>
    <div class="col-xl-8">
      <div class="card mb-4">
        <div class="card-header" style="background-color: #435d7d; color: white;">
          <h4>Accountgegevens</h4>
        </div>
        <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
          <div class="spinner-border text-primary m-2" role="status" style="width: 3rem; height: 3rem;">
              <span class="sr-only"></span>
          </div>
          <p class="mb-0" style="font-size: 1.5rem;">Gegevens worden geladen...</p>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!isLoading">
  <div class="row">
    <div class="col-xl-4">
      <div class="card mb-4 mb-xl-0">
        <div class="card-header" style="background-color: #435d7d; color: white;"><h4>Profielfoto</h4></div>
        <div class="card-body text-center">
          <img class="img-account-profile rounded-circle mb-2" [src]="user.profileImgUrl || 'https://lpcna.nhs.uk/application/files/1516/0322/1131/person-placeholder.jpg'" alt="Profielfoto" style="width: 200px; height: 200px;">
          <div></div>
          <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#uploadPhotoModal">
            Upload nieuwe foto
          </button>
        </div>
      </div>
    </div>
  
    <div class="col-xl-8">
      <div class="card mb-4">
        <div class="card-header" style="background-color: #435d7d; color: white;"><h4>Accountgegevens</h4></div>
        <div class="card-body">
          <form [formGroup]="userForm" (ngSubmit)="onSave()">
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="fs-4 mb-1" for="inputName">Naam</label>
                <input class="form-control" id="inputName" type="text" formControlName="name">
                <div *ngIf="userForm.get('name')?.invalid && userForm.get('name')?.touched" class="text-danger">
                  Naam moet minimaal 5 letters zijn.
                </div>
              </div>
              <div class="col-md-6">
                <label class="fs-4 mb-1" for="inputBirthDate">Geboortedatum</label>
                <input
                  class="form-control"
                  id="inputBirthDate"
                  type="text"
                  formControlName="formattedBirthDate"
                  placeholder="dd-mm-yyyy"
                >
                <div *ngIf="userForm.get('formattedBirthDate')?.invalid && userForm.get('formattedBirthDate')?.touched" class="text-danger">
                  Voer een geldige geboortedatum in (dd-mm-yyyy).
                </div>
              </div>      
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="fs-4 mb-1" for="inputEmail">E-mail</label>
                <input class="form-control" id="inputEmail" type="email" formControlName="emailAddress">
                <div *ngIf="userForm.get('emailAddress')?.invalid && userForm.get('emailAddress')?.touched" class="text-danger">
                  Voer een geldig e-mailadres in.
                </div>
              </div>
              <div class="col-md-6">
                <label class="fs-4 mb-1" for="inputRole">Rol</label>
                <p class="form-control-plaintext">{{ user.role || 'Guest' }}</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="fs-4 mb-1" for="inputGender">Geslacht</label>
                <select class="form-control" id="inputGender" formControlName="gender">
                  <option *ngFor="let gender of genders" [value]="gender">{{ gender }}</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="fs-4 mb-1" for="inputIsActive">Is Actief</label>
                <p class="form-control-plaintext p-0">{{ user.isActive ? 'Ja' : 'Nee' }}</p>
              </div>
            </div>
            <!-- <div class="mb-3">
              <label class="fs-4 mb-1" for="inputInstruments">Instrumenten</label>
              <ul class="list-group">
                <li class="list-group-item" *ngFor="let instrument of user?.instruments">{{ instrument.name }}</li>
              </ul>
            </div> -->
            <div class="col-md-6 mb-3" *ngIf="isNewUser">
              <label class="fs-4 mb-1" for="inputPassword">Wachtwoord</label>
              <input
                class="form-control"
                id="inputPassword"
                type="password"
                formControlName="password"
                placeholder="Voer een wachtwoord in (minimaal 8 tekens)">
              <div *ngIf="userForm.get('password')?.invalid && userForm.get('password')?.touched" class="text-danger">
                Wachtwoord moet minimaal 8 tekens lang zijn.
              </div>
            </div>    
            <div class="mb-3">
              <button class="btn btn-primary" type="submit" [disabled]="userForm.invalid">Opslaan</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="uploadPhotoModal" tabindex="-1" aria-labelledby="uploadPhotoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="uploadPhotoModalLabel">Upload nieuwe profielfoto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="photoForm">
          <div class="mb-3">
            <label for="profileImgUrl" class="form-label">Profielafbeelding-URL</label>
            <input
              type="url"
              id="profileImgUrl"
              class="form-control"
              formControlName="profileImgUrl"
              placeholder="Voer een geldige URL in"
            >
            <div *ngIf="photoForm.get('profileImgUrl')?.invalid && photoForm.get('profileImgUrl')?.touched" class="text-danger mt-2">
              Voer een geldige URL in.
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuleren</button>
        <button type="button" class="btn btn-primary" [disabled]="photoForm.invalid" (click)="updatePhoto()" data-bs-dismiss="modal">Opslaan</button>
      </div>
    </div>
  </div>
</div>